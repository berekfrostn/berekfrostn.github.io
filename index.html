<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumineuse Store</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
    
    <style>
        /* Ganti .hero-bg jadi container */
        .hero-slides {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        /* Pastikan .hero-bg tetap cover */
        .hero-slides .hero-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s cubic-bezier(0.33, 0, 0.66, 1);
        }
    </style>
</head>
<body>

    <!-- NAVBAR -->
    <header class="navbar">
        <div class="logo">Lumineuse</div>
        <nav>
            <a href="#">Home</a>
            <a href="#">Shop</a>
            <a href="#">Pages</a>
            <a href="#footer-about">About Us</a>
            <a href="#">Contact Us</a>
        </nav>
        <div class="nav-text-links">
            <a href="#">Search</a>
            <a href="#">Cart</a>
        </div>
    </header>

    <!-- HERO -->
    <section class="hero">
        <!-- Ganti img jadi container -->
        <div class="hero-slides">
            <img src="/slidebg/1.webp" class="hero-bg" onerror="this.src='/slidebg/1.webp'">
        </div>
        <!-- .hero-content tetap di sini, POSISI DIKONTROL OLEH CSS-MU -->
        <div class="hero-content">
            <h1>EMBRANCING<br>THE CHILL</h1>
            <button class="btn">Discovery Now</button>
        </div>
        <button class="arrow left">‹</button>
        <button class="arrow right">›</button>
    </section>
    
    <section class="products" id="products-section">
        <h2>New Arrivals</h2>
        <div class="products-grid" id="products-grid"></div>
    </section>
	
    <!-- FOOTER -->
    <footer class="footer" id="footer-about">
        <div class="footer-col">
            <h3>Customer Service</h3>
            <a href="#">Help Center</a>
            <a href="#">Shipping Info</a>
            <a href="#">Returns & Refunds</a>
            <a href="#">Track Order</a>
        </div>
        <div class="footer-col">
            <h3>Company</h3>
            <a href="#">Careers</a>
            <a href="#">Partnership</a>
            <a href="#">Press</a>
        </div>
        <div class="footer-col">
            <h3>Follow Us</h3>
            <a href="#">Instagram</a>
            <a href="#">Facebook</a>
            <a href="#">Twitter</a>
        </div>
    </footer>

<script>
// === DETEKSI FILE YANG ADA ===
async function findValidSlides(max = 20) {
    const slides = [];
    for (let i = 1; i <= max; i++) {
        try {
            const res = await fetch(`/slidebg/${i}.webp`, { method: 'HEAD' });
            if (res.ok) slides.push(i);
            else break;
        } catch {
            break;
        }
    }
    return slides;
}

// === SLIDER ===
let validSlides = [];
let currentIndex = 0;
let autoInterval;
let isAnimating = false;

const slidesContainer = document.querySelector('.hero-slides');
const leftBtn = document.querySelector('.arrow.left');
const rightBtn = document.querySelector('.arrow.right');

function createSlideEl(num) {
    const img = document.createElement('img');
    img.className = 'hero-bg';
    img.src = `/slidebg/${num}.webp`;
    img.onerror = () => { img.src = `/slidebg/1.webp`; };
    return img;
}

function renderCurrent() {
    slidesContainer.innerHTML = '';
    if (validSlides.length === 0) return;
    const img = createSlideEl(validSlides[currentIndex]);
    img.style.transform = 'translateX(0)';
    slidesContainer.appendChild(img);
}

function slideTo(direction) {
    if (isAnimating || validSlides.length <= 1) return;
    isAnimating = true;

    const currentNum = validSlides[currentIndex];
    const nextIndex = direction === 'next'
        ? (currentIndex + 1) % validSlides.length
        : (currentIndex - 1 + validSlides.length) % validSlides.length;
    const nextNum = validSlides[nextIndex];

    const currentEl = createSlideEl(currentNum);
    const nextEl = createSlideEl(nextNum);

    // Posisi awal
    currentEl.style.transform = 'translateX(0)';
    nextEl.style.transform = direction === 'next' ? 'translateX(100%)' : 'translateX(-100%)';

    slidesContainer.innerHTML = '';
    slidesContainer.appendChild(currentEl);
    slidesContainer.appendChild(nextEl);

    // Trigger animasi
    setTimeout(() => {
        currentEl.style.transform = direction === 'next' ? 'translateX(-100%)' : 'translateX(100%)';
        nextEl.style.transform = 'translateX(0)';
    }, 10);

    setTimeout(() => {
        currentIndex = nextIndex;
        isAnimating = false;
        renderCurrent();
    }, 500);
}

function next() { slideTo('next'); }
function prev() { slideTo('prev'); }

function startAuto() {
    clearInterval(autoInterval);
    if (validSlides.length > 1) {
        autoInterval = setInterval(next, 2000);
    }
}

leftBtn.addEventListener('click', () => { prev(); startAuto(); });
rightBtn.addEventListener('click', () => { next(); startAuto(); });

// === LOAD PRODUK ===
async function loadProducts() {
    const grid = document.getElementById('products-grid');
    try {
        const res = await fetch('/api/products');
        const products = await res.json();
        grid.innerHTML = '';
        products.forEach((p, i) => {
            const ph = `/placeholder/${(i % 10) + 1}.webp`;
            const clean = p.photo_url?.replace('/uploads/', '') || '';
            const el = document.createElement('div');
            el.className = 'product-card';
            el.innerHTML = `
                <img src="${p.photo_url ? '/photo?file=' + clean : ph}" 
                     alt="${p.name}" onerror="this.src='${ph}'">
                <h3>${p.name}</h3>
                <p class="price">Rp ${p.price}</p>
            `;
            grid.appendChild(el);
        });
    } catch (e) {
        console.warn("Gagal load produk");
    }
}

// === INIT ===
document.addEventListener('DOMContentLoaded', async () => {
    validSlides = await findValidSlides(20);
    if (validSlides.length === 0) {
        slidesContainer.innerHTML = '<img class="hero-bg" src="/slidebg/1.webp">';
    } else {
        renderCurrent();
        startAuto();
    }
    loadProducts();
});
</script>
</body>
</html>
