<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumineuse Store</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
    <style>
        /* === HERO SLIDE ANIMATION === */
        .hero {
            position: relative;
            overflow: hidden;
        }

        .hero-slide-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
        }

        .hero-slide {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s cubic-bezier(0.33, 0, 0.66, 1);
        }

        .hero-content {
            position: relative;
            z-index: 10;
            text-align: center;
        }

        .arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.5);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 20;
        }

        .arrow.left { left: 20px; }
        .arrow.right { right: 20px; }
    </style>
</head>
<body>

    <!-- NAVBAR -->
    <header class="navbar">
        <div class="logo">Lumineuse</div>
        <nav>
            <a href="#">Home</a>
            <a href="#">Shop</a>
            <a href="#">Pages</a>
            <a href="#footer-about">About Us</a>
            <a href="#">Contact Us</a>
        </nav>
        <div class="nav-text-links">
            <a href="#">Search</a>
            <a href="#">Cart</a>
        </div>
    </header>

    <!-- HERO -->
    <section class="hero">
        <div class="hero-slide-container">
            <!-- Akan diisi oleh JS dengan 2 gambar -->
        </div>
        <div class="hero-content">
            <h1>EMBRANCING<br>THE CHILL</h1>
            <button class="btn">Discovery Now</button>
        </div>
        <button class="arrow left">‹</button>
        <button class="arrow right">›</button>
    </section>
    
    <section class="products" id="products-section">
        <h2>New Arrivals</h2>
        <div class="products-grid" id="products-grid"></div>
    </section>
	
    <!-- FOOTER -->
    <footer class="footer" id="footer-about">
        <div class="footer-col">
            <h3>Customer Service</h3>
            <a href="#">Help Center</a>
            <a href="#">Shipping Info</a>
            <a href="#">Returns & Refunds</a>
            <a href="#">Track Order</a>
        </div>
        <div class="footer-col">
            <h3>Company</h3>
            <a href="#">Careers</a>
            <a href="#">Partnership</a>
            <a href="#">Press</a>
        </div>
        <div class="footer-col">
            <h3>Follow Us</h3>
            <a href="#">Instagram</a>
            <a href="#">Facebook</a>
            <a href="#">Twitter</a>
        </div>
    </footer>

<script>
// === DETEKSI SLIDE YANG ADA ===
async function findValidSlides(maxAttempts = 20) {
    const valid = [];
    for (let i = 1; i <= maxAttempts; i++) {
        try {
            const res = await fetch(`/slidebg/${i}.webp`, { method: 'HEAD' });
            if (res.ok) valid.push(i);
            else break;
        } catch {
            break;
        }
    }
    return valid;
}

// === SLIDER LOGIC ===
let validSlides = [];
let currentIdx = 0;
let autoInterval;
let isAnimating = false;

const container = document.querySelector('.hero-slide-container');
const leftBtn = document.querySelector('.arrow.left');
const rightBtn = document.querySelector('.arrow.right');

function createSlide(src, className = '') {
    const img = document.createElement('img');
    img.src = src;
    img.className = `hero-slide ${className}`;
    img.onerror = () => { img.src = `/slidebg/1.webp`; };
    return img;
}

function renderSlides() {
    container.innerHTML = '';
    if (validSlides.length === 0) return;

    const currentSrc = `/slidebg/${validSlides[currentIdx]}.webp`;
    const currentImg = createSlide(currentSrc);
    currentImg.style.transform = 'translateX(0)';
    container.appendChild(currentImg);
}

function animateSlide(direction) {
    if (isAnimating || validSlides.length <= 1) return;
    isAnimating = true;

    const currentSrc = `/slidebg/${validSlides[currentIdx]}.webp`;
    let nextIdx, nextSrc;

    if (direction === 'next') {
        nextIdx = (currentIdx + 1) % validSlides.length;
    } else {
        nextIdx = (currentIdx - 1 + validSlides.length) % validSlides.length;
    }
    nextSrc = `/slidebg/${validSlides[nextIdx]}.webp`;

    const currentImg = createSlide(currentSrc);
    const nextImg = createSlide(nextSrc);

    // Posisi awal
    currentImg.style.transform = 'translateX(0)';
    if (direction === 'next') {
        nextImg.style.transform = 'translateX(100%)'; // dari kanan
    } else {
        nextImg.style.transform = 'translateX(-100%)'; // dari kiri
    }

    container.innerHTML = '';
    container.appendChild(currentImg);
    container.appendChild(nextImg);

    // Trigger animasi
    setTimeout(() => {
        currentImg.style.transform = direction === 'next' ? 'translateX(-100%)' : 'translateX(100%)';
        nextImg.style.transform = 'translateX(0)';
    }, 10);

    setTimeout(() => {
        currentIdx = nextIdx;
        isAnimating = false;
        renderSlides(); // kembali ke single image setelah animasi
    }, 500);
}

function nextSlide() { animateSlide('next'); }
function prevSlide() { animateSlide('prev'); }

function startAuto() {
    clearInterval(autoInterval);
    if (validSlides.length > 1) {
        autoInterval = setInterval(nextSlide, 3000);
    }
}

leftBtn.addEventListener('click', () => {
    prevSlide();
    startAuto();
});

rightBtn.addEventListener('click', () => {
    nextSlide();
    startAuto();
});

// === LOAD PRODUK ===
async function loadProducts() {
    const grid = document.getElementById('products-grid');
    try {
        const res = await fetch('/api/products');
        const products = await res.json();
        grid.innerHTML = '';
        products.forEach((p, i) => {
            const ph = `/placeholder/${(i % 10) + 1}.webp`;
            const clean = p.photo_url?.replace('/uploads/', '') || '';
            const el = document.createElement('div');
            el.className = 'product-card';
            el.innerHTML = `
                <img src="${p.photo_url ? '/photo?file=' + clean : ph}" 
                     alt="${p.name}" onerror="this.src='${ph}'">
                <h3>${p.name}</h3>
                <p class="price">Rp ${p.price}</p>
            `;
            grid.appendChild(el);
        });
    } catch (e) {
        console.warn("Produk gagal dimuat");
    }
}

// === INIT ===
document.addEventListener('DOMContentLoaded', async () => {
    validSlides = await findValidSlides(20);
    if (validSlides.length === 0) {
        // fallback
        container.appendChild(createSlide('/slidebg/1.webp'));
    } else {
        renderSlides();
        startAuto();
    }
    loadProducts();
});
</script>
</body>
</html>
